document.addEventListener("DOMContentLoaded",()=>{const e="04934ab23a2965497d012e4857e7527e",t="https://api.novaposhta.ua/v2.0/json/";let o=document.forms.calculationForm;const s=o.elements["cargo-city-to"],n=o.elements["cargo-city-from"],i=o.elements["cargo-type"],l=o.elements["cargo-option"];function r(){"none"!==this.value&&this.value.trim()?this.style.border="1px solid green":("form__custom-select"===this.className&&(this.previousElementSibling.querySelector("[data-select-title]").style.border="2px solid red"),this.style.border="1px solid red",this.value="")}document.querySelectorAll("[data-select]").forEach(e=>{e.setAttribute("tabindex",0),e.querySelector(".form-select__dropdown").style.overflowY="scroll",e.addEventListener("click",function(e){const t=this.nextElementSibling;if(e.target.hasAttribute("data-select-item")){let o=e.target.getAttribute("data-select-item");this.querySelector("[data-select-title]").textContent=e.target.textContent,this.querySelector(".form-select__dropdown").classList.toggle("hidden"),t.value=o}else this.querySelector(".form-select__dropdown").classList.toggle("hidden")})}),function(e){for(let t=0;t<e.elements.length;t++)"form__custom-select"===e.elements[t].className&&e.elements[t].previousElementSibling.hasAttribute("data-select")&&e.elements[t].previousElementSibling.addEventListener("blur",function(){"none"!==e.elements[t].value?this.querySelector("[data-select-title]").style.border="2px solid green":this.querySelector("[data-select-title]").style.border="2px solid red"}),"button"!==e.elements[t].type&&"submit"!==e.elements[t].type&&(e.elements[t].setAttribute("required","required"),e.elements[t].addEventListener("blur",r));e.addEventListener("submit",h)}(o);const c=e=>{const t=document.createElement("option");return t.value=e.Ref,t.innerText=e.Description,t},a=e=>{const t=document.createElement("div");return t.classList.add("form-select__item"),t.setAttribute("data-select-item",e.Ref),t.textContent=e.Description,t},d=()=>{let o=new Date;o=new Date(o.setDate(o.getDate()+1)),(async(e,t)=>{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(t)});return await o.json()})(t,{modelName:"Address",calledMethod:"getCities",methodProperties:{},apiKey:e}).then(e=>{const t=e.data.map(e=>{return{Description:e.Description,Ref:e.Ref}});localStorage.setItem("cities",JSON.stringify(t)),document.cookie=`${decodeURI("cities")} = ${decodeURI(!0)}; expires = ${o}; path = /`,p("cities",s),p("cities",n)}).catch(e=>{console.log(e)})};void 0===(e=>{let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0})("cities")&&d();const m={modelName:"Common",calledMethod:"getServiceTypes",apiKey:e,methodProperties:{}},u=(e,t,o)=>{(async(e,t)=>{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(t)});return await o.json()})(t,o).then(t=>{if(t.data.forEach(t=>{const o=c(t);e.append(o)}),e.previousElementSibling.hasAttribute(["data-select"])){const o=e.previousElementSibling.querySelector(".form-select__dropdown");o.style.overflowY="scroll";for(let e=0;e<t.data.length;e++){const s=a(t.data[e]);o.append(s)}}})};u(i,t,{modelName:"Common",calledMethod:"getCargoTypes",methodProperties:{},apiKey:e}),u(l,t,m);const p=(e,t)=>{if(null!==localStorage.getItem(e)){const o=JSON.parse(localStorage.getItem(e));if(o.forEach(e=>{const o=c(e);t.append(o)}),t.previousElementSibling.hasAttribute(["data-select"])){const e=t.previousElementSibling.querySelector(".form-select__dropdown");e.style.overflowY="scroll";for(let t=0;t<o.length;t++){const s=a(o[t]);e.append(s)}}let s=t.previousElementSibling.querySelector("[data-select-title]");s.setAttribute("contenteditable",!0),s.addEventListener("focus",function(){this.textContent=""}),s.addEventListener("input",function(){t.previousElementSibling.querySelector(".form-select__dropdown").classList.remove("hidden");let e=this.textContent.trim().toLowerCase(),o=t.previousElementSibling.querySelectorAll(".form-select__item");""!==e?o.forEach(t=>{-1==t.textContent.toLowerCase().search(e)?t.classList.add("hidden"):t.classList.remove("hidden")}):o.forEach(e=>{e.classList.remove("hidden")})})}};function h(o){o.preventDefault();let s={};for(let e in this.elements)this.elements.hasOwnProperty(e)&&this.elements[e].name&&(s[this.elements[e].name]=this.elements[e].value);!function(e){for(let t=0;t<e.elements.length;t++)"form__custom-select"===e.elements[t].className&&(e.elements[t].previousElementSibling.querySelector("[data-select-title]").textContent="Выберите из списка",e.elements[t].previousElementSibling.querySelector("[data-select-title]").style.border="1px solid #c1c4c7"),e.elements[t].value="",e.elements[t].style.border="1px solid #c1c4c7"}(this);let n={modelName:"InternetDocument",calledMethod:"getDocumentPrice",methodProperties:{CitySender:s["cargo-city-from"],CityRecipient:s["cargo-city-to"],Weight:s["cargo-weight"],ServiceType:s["cargo-option"],Cost:"100",CargoType:s["cargo-type"],OptionsSeat:[{volumetricVolume:s["cargo-volume"],volumetricWidth:s["cargo-width"],volumetricLength:s["cargo-length"],volumetricHeight:s["cargo-height"],weight:s["cargo-weight"]}],SeatsAmount:"1"},apiKey:e};fetch(t,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)}).then(e=>e.json()).then(e=>{(new Popup).showPopup("#popup-result",e.data[0].Cost)}).catch(e=>{console.log(e)})}p("cities",s),p("cities",n)});
